# Volvo Service Bot

Телеграм бот для записи на обслуживание автомобилей Volvo в сервисном центре.

## Функциональность

Бот реализует полный процесс создания заявки на обслуживание:

### Этапы заполнения заявки:

1. **Контактная информация**
   - Имя клиента
   - Номер телефона или Telegram для связи

2. **Информация об автомобиле**
   - Модель Volvo
   - Год выпуска
   - Тип двигателя (бензин/дизель/гибрид/электро)
   - Объем двигателя
   - Текущий пробег

3. **Информация о проблеме**
   - Описание проблемы
   - Когда впервые появилась проблема
   - Частота проявления проблемы
   - Влияние на безопасность
   - Предыдущие попытки ремонта
   - Недавние изменения в автомобиле

4. **Выбор даты и времени**
   - Выбор из доступных дат
   - Выбор временного слота

5. **Завершение**
   - Сохранение заявки в MongoDB
   - Отправка подтверждения клиенту

## Технологии

- **Язык**: Go 1.24.5
- **База данных**: MongoDB
- **Telegram API**: go-telegram-bot-api
- **Конфигурация**: godotenv

## Структура проекта

```
volvo-master/
├── main.go                 # Основной файл приложения
├── go.mod                  # Зависимости Go
├── go.sum                  # Хеши зависимостей
├── .env                    # Переменные окружения (создать самостоятельно)
├── README.md              # Документация
├── cmd/
│   ├── add_dates/
│   │   └── main.go        # Утилита для добавления тестовых дат
│   └── view_users/
│       └── main.go        # Утилита для просмотра информации о пользователях
└── internal/
    ├── bot/
    │   └── bot.go         # Основная логика бота
    ├── config/
    │   └── config.go      # Конфигурация приложения
    ├── database/
    │   └── database.go    # Подключение к MongoDB
    ├── logger/
    │   └── logger.go      # Структурированный логгер
    ├── models/
    │   └── models.go      # Модели данных
    └── services/
        ├── database.go    # Сервис для работы с БД
        └── admin.go       # Административные функции
```

## Установка и запуск

### 1. Клонирование репозитория
```bash
git clone <repository-url>
cd volvo-master
```

### 2. Установка зависимостей
```bash
go mod download
```

### 3. Создание файла .env
Создайте файл `.env` в корне проекта:
```env
TELEGRAM_BOT_TOKEN=your_telegram_bot_token
MONGO_URI=mongodb://localhost:27017
```

### 4. Запуск MongoDB
Убедитесь, что MongoDB запущена и доступна по адресу из MONGO_URI.

### 5. Управление датами (рекомендуется)
```bash
go run cmd/admin_interface/main.go
```
Запускает веб-интерфейс на http://localhost:8080 для удобного управления датами и просмотра заявок.

**Возможности:**
- ✅ Добавление дат на неделю/месяц одним кликом
- ✅ Добавление конкретных дат
- ✅ Просмотр всех доступных дат
- ✅ Удаление дат
- ✅ Просмотр всех заявок



### 7. Запуск бота
```bash
go run main.go
```

## Использование

### Команды бота

- `/start` - Начать новую заявку
- `/cancel` - Отменить текущую заявку
- `/help` - Показать справку

### Процесс создания заявки

1. Пользователь отправляет `/start`
2. Бот запрашивает имя
3. Бот запрашивает контактную информацию
4. Бот запрашивает информацию об автомобиле
5. Бот запрашивает информацию о проблеме
6. Бот показывает доступные даты для записи
7. Пользователь выбирает дату и время
8. Заявка сохраняется в базе данных

## Структура базы данных

### Коллекции MongoDB:

1. **users** - Пользователи бота
   - user_id, chat_id, username, first_name, last_name, phone, telegram, created_at, updated_at

2. **service_requests** - Заявки на обслуживание
   - Все поля заявки включая этапы заполнения и статус

3. **available_dates** - Доступные даты для записи
   - date, time_slots, is_active, created_at, updated_at

4. **user_sessions** - Сессии пользователей
   - user_id, chat_id, stage, request_id, data, updated_at



## Логирование

Бот использует структурированный логгер с уровнями:
- INFO - Информационные сообщения
- ERROR - Ошибки
- DEBUG - Отладочная информация

## Особенности реализации

1. **Этапность**: Бот ведет пользователя по этапам заполнения заявки
2. **Валидация**: Проверка корректности вводимых данных
3. **Inline кнопки**: Удобный выбор дат и времени
4. **Сессии**: Сохранение состояния пользователя
5. **Обработка ошибок**: Корректная обработка всех ошибок
6. **Логирование**: Подробное логирование всех операций

## Требования к системе

- Go 1.24.5 или выше
- MongoDB 4.0 или выше
- Доступ к интернету для работы с Telegram API

## Лицензия

Проект создан для внутреннего использования сервисного центра Volvo. 